<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>White Penguin Solutions</title>
    <script defer="defer" src="static/js/main.308d43c8.js"></script>
    <link href="static/css/main.168a84df.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>

  <body>
    <div id="root"></div>

    <!-- Contact form handler injection for Google Apps Script webhook -->
<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzNZLBvqFgLVI_Y8oE4mxTVbv1HLn5T84GGrBRMOwv_TLc-jbL369IGnm_JEUOdjA9t/exec";

  document.addEventListener("DOMContentLoaded", () => {
    setTimeout(() => {
      // find candidate form (most likely contact card)
      let form =
        document.querySelector("form") ||
        document.getElementById("contact-form") ||
        document.querySelector("[data-contact-form]");

      if (!form) {
        console.warn("Contact form not found — contact handler not attached.");
        return;
      }
      if (form.__wpsAttached) return;
      form.__wpsAttached = true;

      // add status box
      const statusBox = document.createElement("div");
      statusBox.style.marginTop = "12px";
      statusBox.style.fontSize = "14px";
      form.appendChild(statusBox);

      // helper: collect value by many heuristics
      function findFieldValue(keys, typeHint) {
        // try by name attributes
        for (const k of keys) {
          const el = form.querySelector(`[name="${k}"]`);
          if (el && el.value !== undefined) return el.value.trim();
        }
        // try type=email for email
        if (typeHint === "email") {
          const el = form.querySelector('input[type="email"]');
          if (el && el.value !== undefined) return el.value.trim();
        }
        // try placeholders or aria-label or id
        const inputs = Array.from(form.querySelectorAll("input, textarea"));
        for (const el of inputs) {
          const ph = (el.getAttribute("placeholder") || "").toLowerCase();
          const al = (el.getAttribute("aria-label") || "").toLowerCase();
          const id = (el.id || "").toLowerCase();
          for (const k of keys) {
            const kl = k.toLowerCase();
            if (ph.includes(kl) || al.includes(kl) || id.includes(kl)) {
              return el.value ? el.value.trim() : "";
            }
          }
        }
        return null;
      }

      function guessByOrder() {
        // fallback: assume first text input = name, first email or second input = email, first textarea = message
        const inputs = Array.from(form.querySelectorAll("input"));
        const textInputs = inputs.filter(i => i.type === "text" || i.type === "search" || !i.type);
        const emailInput = inputs.find(i => i.type === "email") || inputs[1] || inputs[0];
        const textarea = form.querySelector("textarea");
        return {
          name: textInputs[0] ? (textInputs[0].value || "").trim() : "",
          email: emailInput ? (emailInput.value || "").trim() : "",
          message: textarea ? (textarea.value || "").trim() : ""
        };
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        // first, try common keys
        const nameKeys = ["user_name", "name", "fullName", "fullname", "your_name"];
        const emailKeys = ["user_email", "email", "your_email"];
        const messageKeys = ["message", "body", "user_message", "comments"];

        let name = findFieldValue(nameKeys, "text");
        let email = findFieldValue(emailKeys, "email");
        let message = findFieldValue(messageKeys, "text");

        // if any missing, try more heuristics or order-based guess
        if (!name || !email || !message) {
          const guessed = guessByOrder();
          name = name || guessed.name;
          email = email || guessed.email;
          message = message || guessed.message;
        }

        // final safety: empty string instead of null
        name = name || "";
        email = email || "";
        message = message || "";

        // DEBUG: log what we're sending (open console to inspect)
        console.info("WPS form payload →", { name, email, message });

        statusBox.style.color = "black";
        statusBox.textContent = "Sending...";

        try {
          const urlEncoded = new URLSearchParams();
          urlEncoded.append("user_name", name);
          urlEncoded.append("user_email", email);
          urlEncoded.append("message", message);

          const res = await fetch(SCRIPT_URL, {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: urlEncoded.toString()
          });

          const text = await res.text();
          let json = null;
          try { json = JSON.parse(text); } catch (err) { /* not JSON */ }

          if (res.ok && json && json.status === "success") {
            statusBox.style.color = "green";
            statusBox.textContent = "Thanks — we received your message. We will get back to you shortly.";
            form.reset();
          } else {
            statusBox.style.color = "red";
            statusBox.textContent = "Error sending message. Try again later.";
            console.error("Apps Script response:", res.status, text);
          }
        } catch (err) {
          statusBox.style.color = "red";
          statusBox.textContent = "Network error. Try again later.";
          console.error("Network/fetch error:", err);
        }
      });
    }, 1500);
  });
</script>
  </body>
</html>
